<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>BURGERIA!</title>
    <style media="screen">
      :root {
        --line-height: 1.1rem;

        --burgeria: red;
        --burgeria-bg: pink;
        --newsgray: #dcdcdc;
        --lines: black;
        --bg: white;
        --graph-neutral: var(--lines);
        --graph-negative: var(--burgeria);
        --graph-positive: blue;
      }

      body.grabbing, body.grabbing * {
        cursor: grabbing;
        user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
      }

      body {
        margin: auto;
        margin-top: 1rem;
        max-width: calc(1000px + 1rem);

        background-color: var(--bg);
        background-image: radial-gradient(var(--burgeria-bg) 1px, transparent 0);
        background-size: 20px 20px;

        color: var(--lines);

        animation: burgeria-bg 2s linear infinite;
      }
      @keyframes burgeria-bg {
        0% {
          background-position: 0px 0px;
        }
        100% {
          background-position: 20px 20px;
        }
      }

      header {
        padding: 0;
        border-bottom: 1px solid var(--burgeria);
        margin-bottom: 1rem;
        color: var(--burgeria);
        position: relative;
      }

      header h1 {
        display: inline-block;
        pointer-events: unset;
        cursor: pointer;
      }

      h1, h2 {
        pointer-events: none;
      }

      h1 {
        font-size: 50px;
        font-weight: bold;
        transform: scaleY(1.7);
        margin: 0;
        line-height: 1.2em;
        white-space: nowrap;
      }

      h2 {
        margin: 0;
        line-height: 1em;
        font-weight: bold;
        font-size: 1rem;
        margin-bottom: .5rem;
      }

      .block {
        border: 1px solid var(--lines);
        padding: .5rem;
        margin-bottom: 1rem;
        background: var(--bg);
        position: relative;
      }

      .news {
        background: var(--newsgray);
      }

      #navbar {
        border-color: var(--burgeria);
        display: flex;
        justify-content: space-between;
        height: fit-content;
      }

      .menu b {
        display: block;
      }

      .tray {
        border: 1px solid var(--lines);
        width: 100%;
        padding: 0;
      }
      .tray::after {
        content: attr(name);
        position: absolute;
        line-height: 1px;
        top: 0;
        left: 0;
        transform: translate(1rem, calc(-50% - .5px));
        padding-left: .25rem;
        padding-right: .25rem;
        background: var(--bg);
      }

      .has-footer {
        padding-bottom: 1.5rem;
      }
      .block footer {
        width: 100%;
        justify-content: space-between;
        border-top: 1px solid var(--lines);
        position: absolute;
        bottom: 0;
        left: 0;
        height: 1.5rem;
      }
      .tray main {
        display: flex;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
      }
      .container {
        width: 50%;
        /* height: 100%; */
        display: flex;
        flex-direction: column;
        gap: .5rem;
        padding: 0;
        box-sizing: border-box;
      }
      .tray .container {
        padding: .5rem;
      }
      .container:first-child {
        padding-right: .25rem;
      }
      .container:last-child {
        padding-left: .25rem;
      }
      button {
        margin: 0;
        border: 1px solid var(--lines);
        font-family: inherit;
        font-size: inherit;
        background: var(--bg);
        cursor: pointer;
        color: inherit;
        height: 1.5rem;
      }
      /* button:hover {
        background: var(--burgeria);
        color: var(--bg);
      } */
      button:active {
        background: var(--burgeria);
        color: var(--bg);
        font-style: italic;
      }
      button.disabled {
        pointer-events: none;
        opacity: .2;
      }
      button.selected {
        background: var(--burgeria);
        color: var(--bg);
        font-style: italic;
        pointer-events: none;
      }
      footer button {
        border-top: none;
        border-bottom: none;
        border-right: 1px solid var(--lines);
      }

      li button {
        margin-top: 5px;
      }

      .slide-up {
        animation: slide-up .5s;
      }
      @keyframes slide-up {
        0% {
          opacity: 0;
          transform: translate(0, 50%);
        }
        100% {
          opacity: 1;
          transform: translate(0, 0);
        }
      }

      .slide-down {
        animation: slide-down .5s;
      }
      @keyframes slide-down {
        0% {
          opacity: 0;
          transform: translate(0, -50%);
        }
        100% {
          opacity: 1;
          transform: translate(0, 0);
        }
      }

      .sending {
        /* opacity: 0; */
        animation: send .5s;
        pointer-events: none;
      }
      @keyframes send {
        0% {
          transform: scale(1, 1);
          max-height: 100vh;
        }
        100% {
          transform: scale(1.2, 0);
          max-height: 0;
        }
      }
      /* @keyframes send {
        100% { }
      } */
      .removing-ticket {
        animation: removing-ticket 1s;
      }
      @keyframes removing-ticket {
        0% {
          opacity: 1;
          transform: translate(0, 0) rotate(0deg);
        }
        100% {
          opacity: 0;
          transform: translate(-50%, -100%) rotate(90deg);
        }
      }

      .collection {
        border: 1px dashed var(--lines);
        border-radius: 1rem;
        text-align: center;
        box-sizing: border-box;
        line-height: var(--line-height);
        overflow: hidden;
        height: 100%;
        color: var(--lines);

        display: flex;
        flex-direction: column;
        flex-wrap: nowrap;
        align-items: center;
        justify-content: center;
      }
      .collection:hover .item:first-child, .collection:active .item:first-child {
        background: var(--burgeria);
        color: var(--bg);
      }

      .collection.empty {
        opacity: .5;
      }
      .collection.empty::after {
        content: attr(placeholder);
        font-style: italic;
      }

      .collection.draghover {
        opacity: 1;
      }
      .collection.draghover::after {
        content: "";
      }
      .collection.draghover .item:first-child {
        font-style: italic;
      }

      .collection.at-capacity {
        border-style: solid;
      }
      .collection.at-capacity.draghover .item:first-child {
        color: var(--lines);
        background: var(--bg);
        font-style: normal;
      }

      .collection.preview {
        pointer-events: none;
        border-style: solid;
      }

      .collection .item {
        border: none;
        max-width: 70%;
        padding-left: .5rem;
        padding-right: .5rem;
      }

      .draggable {
        cursor: pointer;
        cursor: grab;
        user-select: none;
        -ms-user-select: none;
        -webkit-user-select: none;
      }
      .draggable:hover {
        background: var(--burgeria);
        color: var(--bg);
      }
      .collection.draggable {
        background: var(--bg);
        color: var(--lines);
      }
      .dragghost {
        position: absolute;
        pointer-events: none;
        opacity: .5;
        z-index: 100;
        transform: translate(-50%, -50%);
      }
      .dragghost li {
        display: block;
      }

      canvas {
        display: block;
        width: 10rem;
        height: 10rem;
        margin: auto;
      }
      .tray canvas {
        height: 100%;
      }

      ul {
        margin: 0;
      }
      ul.flexbox {
        margin-bottom: 0;
        display: flex;
        width: 100%;
        flex-wrap: wrap;
      }
      ul.flexbox > li {
        width: 30%;
      }

      .prices-graph {
        display: grid;
        width: 100%;
        height: 10rem;
        grid-template-columns: repeat(27, 1fr);
        grid-template-rows: auto 1rem;
        column-gap: 3px;
      }

      .graphvaluepoint {
        position: absolute;
        left: 0;
        font-size: .8rem;
        transform: translate(-.3rem, 50%);
        background: var(--newsgray);
        z-index: 1;
      }
      .graphline {
        position: absolute;
        border-top: 1px dashed gray;
        height: 0;
        width: 100%;
        left: 0;
        top: 0;
        z-index: 0;
        transform: translate(0, .4rem);
      }

      .graphbar {
        align-self: end;
        background: var(--graph-neutral);
        z-index: 1;
      }
      .graphbar.past {
        background: transparent !important;
        border: 1px dashed var(--newsgray);
        border-bottom: none;
        z-index: 2;
      }
      .graphbar.positive {
        background: var(--graph-positive);
        border-left: none;
        border-right: none;
      }
      .graphbar.negative {
        background: var(--graph-negative);
        border-color: var(--graph-negative);
      }
      .graphlabel {
        text-align: center;
      }

      .tooltip {
        position: absolute;
        border: 1px solid var(--lines);
        background: var(--newsgray);
        padding: .5rem;
        padding-top: 0;
        pointer-events: none;
        top: calc(100% - 1rem);
        left: 50%;
        transform: translate(-50%, 0);
        text-align: center;
        white-space: nowrap;
      }

      input, textarea {
        font-family: inherit;
        font-size: inherit;
        border: 1px solid var(--lines);
        background: var(--bg);
        padding: .5rem;
        margin: 0;
        width: 100%;
        box-sizing: border-box;
        resize: none;
      }
      textarea {
        min-height: 5rem;
      }
      input::placeholder, textarea::placeholder {
        font-style: italic;
      }

      .scene {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }
      .scene > div {
        width: 500px;
      }

      p.block {
        margin: 0;
        margin-left: -.5rem;
        margin-right: -.5rem;
        border-left: none;
        border-right: none;
        background: var(--newsgray);
        text-align: justify;
        white-space: pre-wrap;
        word-break: break-word;
      }

      .burgerpoints {
        display: inline-block;
        width: calc(1ch + .25rem);
        height: 1rem;
        position: relative;
        vertical-align: top;

        /* border: 1px solid var(--lines); */
        border-radius: 50%;
        box-sizing: border-box;
      }
      .burgerpoints::after {
        content: "✸";
        display: inline-block;
        height: 1rem;
        width: 1rem;
        text-align: center;

        position: absolute;
        box-sizing: border-box;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
      .particle {
        position: absolute;
        transform: translate(-50%, -50%);
        animation: lifespan 1s;
        font-size: .8rem;
        color: var(--burgeria);
        pointer-events: none;
      }
      @keyframes lifespan {
        0% {
          opacity: 0;
          transform: scale(1, 1);
        }
        50% {
          opacity: .5;
          transform: scale(1.1, 1.1);
        }
        100% {
          opacity: 0;
          transform: scale(1, 1);
        }
      }

      #burgeria-timer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--lines);
        opacity: .5;
      }
      #burgeria-timer.transition {
        animation: transition-up .5s ease-out;
      }
      @keyframes transition-up {
        0% {
          height: 100%;
        }
        100% {
          height: 0%;
        }
      }

      @media (max-width: calc(1000px + 1rem)) {
        body {
          max-width: 500px;
        }
        .scene {
          display: block;
        }
        .scene > div {
          width: inherit;
        }
      }

      .top {
        position: absolute;
        top: 0;
        border-top: none;
      }
      .right {
        position: absolute;
        text-align: right;
        right: 0;
        border-right: none;
      }
      .left {
        position: absolute;
        left: 0;
        border-left: none;
      }
      .bottom {
        border-bottom: none;
        position: absolute;
        bottom: 0;
      }

      .block footer button {
        border-left: none;
      }
      .block footer button:last-child {
        border-left: 1px solid var(--lines);
        border-right: none;
      }

      #guys-container {
        column-gap: .5rem;
      }
      #guys-container > div {
        width: calc(20% - .4rem);
        position: relative;
      }
      .guy div[name="text"] {
        display: inline;
        margin: 0;
        border-style: dashed;
        border-top: none;
        padding: 3px;
        min-height: 1rem;
        text-align: justify;
      }
      .guy div[name="text"] * {
        display: inline;
      }
      .guy div[name="text"] *::after {
        content: " ";
      }

      .guy div[name="number"] {
        margin: 0;
        border: 1px dashed var(--lines);
        border-top: none;
        padding: 3px;
      }

      em {
        color: var(--burgeria);
        /* font-style: italic; */
        font-style: normal;
        font-weight: normal;
      }

      #scene-recipes b {
        margin-top: 1rem;
      }
      #scene-recipes b:first-child {
        margin-top: 0;
      }

      #recipe-preview {
        width: 50%;
      }

      /*  */

      .marginbelow {
        margin-bottom: 1rem;
      }
      .margintop {
        margin-top: 1rem;
      }
      .dashed {
        border-style: dashed;
      }
      .attached-above {
        margin-top: -1rem;
        border-top: none;
      }
      .attached-below {
        margin-bottom: 0;
        border-bottom: none;
      }
      .attached-right {
        border-right: none;
      }
      .attached-left {
        border-left: none;
      }

      .flexbox {
        position: relative;
        display: flex;
      }
      .flexbox.wrap {
        flex-wrap: wrap;
      }
      .flexbox.column {
        flex-direction: column;
      }
      .flexbox.gap {
        gap: .5rem;
      }
      .flexbox .grow {
        flex-grow: 1;
      }

      .centeroriginY {
        transform-origin: 0 50%;
      }

      .hidden {
        visibility: hidden;
        width: 0;
        height: 0;
        pointer-events: none;
        transform: scale(0, 0);
      }
      .gone {
        display: none !important;
      }
    </style>
  </head>
  <body>

    <header>
      <h1 onclick="scenes.switchLocation();">BURGERIA!</h1>
      <h2 class="top right">이게 바로 버거야!<br>버거리아</h2>
      <button class="bottom right" onclick="toggleTheme(); sfx('click');" title="toggle theme" style="height: 1.5rem; border-right: 1px solid; border-color: var(--burgeria);"><span id="theme-name"></span></button>
    </header>

    <div id="navbar" class="block">
      <i>You are in the <b id="currentLocation">STOREFRONT</b>.</i>
      <button onclick="scenes.switchLocation()">go to the <b id="otherLocation">KITCHEN</b></button>
    </div>

    <div id="scene-storefront" class="scene">
      <div class="">
        <div class="menu flexbox">
          <div class="block grow">
            <h1 class="marginbelow">MENU</h1>
            <div id="scene-recipes">
            </div>
          </div>
          <div id="recipe-preview" class="block attached-left">
            <canvas width="300" height="300"></canvas>
            <div class="flexbox">
              <div class="container">
                <div class="collection empty" placeholder="burger" data-capacity="-1">
                </div>
              </div>
              <div class="container">
                <div class="collection empty" placeholder="drink" data-capacity="1">
                </div>
                <div class="collection empty" placeholder="side" data-capacity="1">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="scene-storefront-news">

        </div>
      </div>
      <div id="scene-storefront-body" style="padding-bottom: 10rem;">
        <div id="storefront-ministock" class="block gone" style="position: absolute; z-index: 10;"></div>

        <div class="flexbox">
          <div class="block attached-right" style="width: 1rem; text-align: center;">
            <span id="burgeria-day-icon"> </span>
            <div id="burgeria-timer"></div>
          </div>
          <div class="block flexbox gap" style="flex-grow: 1;">
            <div class="grow">
              <i>The store is <b id="day-state"> </b>.</i>
            </div>
            <button onclick="_game.burgeria();" id="day-toggle-button"> </button>
          </div>
        </div>
        <div id="guys-container" class="flexbox wrap attached-above marginbelow">
        </div>
      </div>
    </div>

    <div id="scene-kitchen" class="scene hidden">
      <div>
        <div class="flexbox">
          <div class="block attached-right"><b>BurgerPoints</b></div>
          <div class="block grow">
            You have <span class="burgerpoints" title="BurgerPoints"></span><span id="points-counter"> </span>.
          </div>
        </div>
        <div class="block">
          <h1 class="marginbelow">STOCK</h1>
          <ul id="inventory-list" class="flexbox">
          </ul>
        </div>
        <div class="block">
          <h1>WORKSHOP</h1>
        </div>
        <div class="block attached-above" style="border-bottom: none;">
          <b>LETTERSTOCK</b>
          <ul id="letters-list" class="flexbox">
          </ul>
        </div>
        <div class="attached-above">
          <textarea id="workshop-textarea" placeholder="click here to start typing..."></textarea>
        </div>
      </div>
      <div>
        <div class="block dashed attached-below">
          <span id="ingredient-buttons" class="flexbox gap wrap" style="align-items: center;">
            <b style="margin-right: .5rem;">create ingredient</b>
          </span>
        </div>
        <div class="block" style="border-bottom: none;">
          <h1>LIBRARY</h1><div style="font-style: italic;">Transmute words into burgers</div>
        </div>

        <div class="block attached-above has-footer" id="library-page-container">
          <nav id="library-nav" style="text-align: center; margin-bottom: .5rem;">
            <button class="disabled" title="go to previous page" onclick="navigateLibrary(-1); sfx('click');">←</button>
            <span id="library-index"></span>/<span id="library-pages-total"></span>
            <button class="disabled" title="go to next page" onclick="navigateLibrary(1); sfx('click');">→</button>
          </nav>
          <p id="library-page" class="block"></p>
          <footer class="flexbox">
            <div class="grow"></div>
            <button onclick="playerdata.library[playerdata.libraryIndex].disintegrate(); sfx('click');">disintegrate</button>
          </footer>
        </div>
        <div id="library-page-empty" class="gone block attached-above">
          <i>There are no words here.</i>
        </div>

        <!-- this is for LATER game stuff -->
        <!-- <div class="block">
          <h1 class="marginbelow">R&D</h1>
          <div class="flexbox gap">
            <b>develop new ingredient</b>
            <input type="text" name="" value="" placeholder="click here to start typing...">
          </div>
        </div> -->
      </div>
    </div>

    <template id="template-tray">
      <div class="flexbox">
        <div name="number" class="block top right" style="border: 1px dashed var(--lines)">99</div>
        <div class="tray block has-footer" name="tray">
          <main>
            <div class="container">
              <div class="collection empty" placeholder="burger" data-capacity="-1">
              </div>
            </div>
            <div class="container">
              <div class="collection empty" placeholder="drink" data-capacity="1">
              </div>
              <div class="collection empty" placeholder="side" data-capacity="1">
              </div>
            </div>
          </main>
          <footer class="flexbox">
            <button name="send">send off</button>
            <button name="clear">clear</button>
            <div class="grow"></div>
            <button name="stock">stock ☰</button>
          </footer>
        </div>
        <div>
          <canvas width="300" height="300"></canvas>
        </div>
      </div>
    </template>

    <template id="template-news-headline">
      <div class="news block">
        <button class="top right" title="close" onclick="this.parentNode.parentNode.remove(); sfx('click');">x</button>
        <div class="centeroriginY">
          <h1 id="line1">BIG BURGERS...</h1>
        </div>
        <div class="flexbox centeroriginY" style="margin-top: .5rem; align-items: flex-start; justify-content: space-between;">
          <div><i>The Journal</i></div>
          <h1 id="line2" style="text-align: right;">... ARE IN!</h1>
        </div>
      </div>
    </template>

    <template id="template-news-prices">
      <div class="news block">
        <button class="top right" title="close" onclick="this.parentNode.parentNode.remove(); sfx('click');">x</button>
        <div style="margin-bottom: .5rem;">
          <b>Letter Prices</b>—<i>your daily ABC's</i>
        </div>
        <div class="prices-graph">
          <div class="points-holder" style="position: relative;"></div>
        </div>
      </div>
    </template>

    <template id="template-guy">
      <div class="guy flexbox column">
        <div name="number" class="block top left">99</div>
        <img src="img/cat.png" alt="cat" title="cat">
        <div name="text" class="block attached-top"></div>
      </div>
    </template>

  </body>
  <script type="text/javascript">
    var _objectTimeouts = [];
    function setObjectTimeout(object, func, time) {
      _objectTimeouts.push({
        object: object,
        func: func,
        time: time,
      });
    }
    function _objectTimeoutUpdate() {
      for (let i=_objectTimeouts.length-1; i>=0; i--) {
        let timeout = _objectTimeouts[i];
        timeout.time--;
        if (timeout.time <= 0) {
          timeout.object[timeout.func]();
          _objectTimeouts.splice(i, 1);
        }
      }
    }
    setInterval(_objectTimeoutUpdate, 1);

    // var _animateBG = {
    //   x: 0, y: 0,
    //   w: 20, h: 20,
    //   update: function() {
    //     _animateBG.x += .2;
    //     _animateBG.y += .2;
    //     if (_animateBG.x > _animateBG.w) _animateBG.x = 0;
    //     if (_animateBG.y > _animateBG.h) _animateBG.y = 0;
    //     document.body.style.backgroundPosition = _animateBG.x+"px "+_animateBG.y+"px";
    //     requestAnimationFrame(_animateBG.update);
    //   }
    // };
    // _animateBG.update();
  </script>
  <script type="text/javascript" src="js/howler.core.js"></script>
  <script type="text/javascript" src="js/three.min.js"></script>
  <script type="text/javascript" src="js/sound.js"></script>
  <script type="text/javascript" src="js/dragdrop.js"></script>
  <script type="text/javascript" src="js/items.js"></script>
  <script type="text/javascript" src="js/workshop.js"></script>
  <script type="text/javascript" src="js/guy.js"></script>
  <script type="text/javascript" src="js/ui.js"></script>
  <script type="text/javascript" src="js/game.js"></script>
  <script type="text/javascript">
    _game.config.init_playerdata();

    _game.init();
  </script>
</html>
